<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Joel R Pradines" />

<meta name="date" content="2026-01-18" />

<title>Examples of usage of the Java heparansulfate package</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">heparansulfate Java package</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li>
  <a href="figure_examples.html">Figure Examples</a>
</li>
<li>
  <a href="./api/index.html">API (Javadoc)</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/JoelRMath/heparan-sulfate">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://joelrmath.github.io/">
    <span class="fa fa-user"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Examples of usage of the Java
heparansulfate package</h1>
<h4 class="author">Joel R Pradines</h4>
<h4 class="date">2026-01-18</h4>

</div>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The Java package heparansulfate is built with the code developed
for</p>
<p>“Combining measurements to estimate properties and characterization
extent of complex biochemical mixtures; applications to Heparan
Sulfate”. J.R. Pradines, D. Beccati, M. Lech, J. Ozug, V. Farutin, Y.
Huang, N.S. Gunay &amp; I. Capila. Scientific Reports volume 6, Article
number: 24829 (2016). <a
href="https://www.nature.com/articles/srep24829" target="_blank">[full
text]</a></p>
<p>Examples of usage are provided by running via <code>rJava</code> the
code utilized to make the 6 figures of the publication. Figures are then
rendered with <code>ggplot2</code>.</p>
<pre class="r"><code>library(ggplot2)
library(patchwork)
library(scales)</code></pre>
<pre class="r"><code>library(rJava)
options(java.parameters = &quot;-Xmx8000m&quot;)
jar_path &lt;- normalizePath(&quot;../target/heparan-sulfate-1.0-SNAPSHOT-jar-with-dependencies.jar&quot;, mustWork = TRUE) 
.jinit(classpath = jar_path)
#&gt; [1] 0
input_dir &lt;- paste0(normalizePath(&quot;../input/&quot;, mustWork = TRUE), &quot;/&quot;) 
output_base &lt;- paste0(normalizePath(&quot;../output/&quot;, mustWork = TRUE), &quot;/&quot;)</code></pre>
</div>
<div id="figure-1" class="section level2">
<h2>Figure 1</h2>
<pre class="r"><code># Data
out_dir_hi &lt;- paste0(output_base, &quot;HI/&quot;) 
.jcall(&quot;heparansulfate.HIModel&quot;, &quot;V&quot;, &quot;hepI&quot;, input_dir, out_dir_hi) 
.jcall(&quot;heparansulfate.HIModel&quot;, &quot;V&quot;, &quot;hepIII&quot;, input_dir, out_dir_hi)</code></pre>
<p>Figure 1. Distributions of fragment lengths <span
class="math inline">\(l\)</span> in heparinase digests (crosses) as
compared to distributions expected under model H&amp;I (dots). Relative
abundances are summed for <span class="math inline">\(l ≥ 11\)</span>
(heparinase I, (a)) and for <span class="math inline">\(l ≥ 6\)</span>
(heparinase III, (b)).</p>
<pre class="r"><code># Plot
plot_figure1_panel &lt;- function(exp_file, model_file, title, threshold, is_hepI = FALSE) {
  
  df_exp &lt;- read.table(exp_file, header = TRUE)
  df_mod &lt;- read.table(model_file, header = TRUE)
  df_combined &lt;- merge(df_exp, df_mod, by = &quot;l&quot;)
  
  all_vals &lt;- c(df_combined$f, df_combined$h)
  y_min &lt;- min(all_vals[all_vals &gt; 0]) # Avoid log(0)
  y_max &lt;- max(all_vals)
  
  x_labels &lt;- c(as.character(1:(threshold-1)), paste0(&quot;≥&quot;, threshold))
  
  p &lt;- ggplot(df_combined, aes(x = factor(l))) +
    geom_point(aes(y = f, shape = &quot;Experimental&quot;), size = 5, stroke = 1) +
    geom_point(aes(y = h, shape = &quot;Model H&amp;I&quot;), size = 5, stroke = 1) +
    
    scale_shape_manual(name = &quot;&quot;, values = c(&quot;Experimental&quot; = 4, &quot;Model H&amp;I&quot; = 1)) +
    scale_x_discrete(labels = x_labels) +
    labs(title = title, x = &quot;Fragment Length l&quot;, y = &quot;Relative Abundance (log scale)&quot;) +
    theme_bw() +
    theme(
      legend.position = &quot;bottom&quot;,
      panel.grid.minor = element_blank(),
      axis.text = element_text(size = 1),        
      axis.title = element_text(size = 14),       
      plot.title = element_text(size = 16, face = &quot;bold&quot;), 
      legend.text = element_text(size = 12)       
    )

  if (is_hepI) {
    p &lt;- p + scale_y_log10(
      limits = c(0.02, 0.5),
      breaks = c(0.05, 0.1, 0.2, 0.5),
      labels = c(&quot;0.05&quot;, &quot;0.1&quot;, &quot;0.2&quot;, &quot;0.5&quot;)
    )
  } else {
    p &lt;- p + scale_y_log10(
      limits = c(y_min * 0.8, y_max * 1.2),
      breaks = scales::log_breaks(n = 5)
    )
  }
  
  return(p)
}

file_exp_hepI &lt;- &quot;../input/hepI.f.txt&quot;
file_HIM_hepI &lt;- &quot;../output/HI/HIM.hepIhl.res&quot;
file_exp_hepIII &lt;- &quot;../input/hepIII.f.txt&quot;
file_HIM_hepIII &lt;- &quot;../output/HI/HIM.hepIIIhl.res&quot;

p1 &lt;- plot_figure1_panel(file_exp_hepI, file_HIM_hepI, &quot;(a) Heparinase I&quot;, 11, is_hepI = TRUE)
p2 &lt;- plot_figure1_panel(file_exp_hepIII, file_HIM_hepIII, &quot;(b) Heparinase III&quot;, 6, is_hepI = FALSE)

p1 + p2</code></pre>
<p><img src="figure_examples_files/figure-html/figure1_plot-1.png" width="960" /></p>
</div>
<div id="figure-2" class="section level2">
<h2>Figure 2</h2>
<pre class="r"><code>input_dir_abs &lt;- paste0(normalizePath(&quot;../input/&quot;, mustWork = TRUE), &quot;/&quot;)
output_dir_abs &lt;- paste0(normalizePath(&quot;../output/HC/&quot;, mustWork = TRUE), &quot;/&quot;)
java_args &lt;- .jarray(c(input_dir_abs, output_dir_abs), &quot;java/lang/String&quot;)
.jcall(&quot;heparansulfate.HCModelSA&quot;, &quot;V&quot;, &quot;main&quot;, java_args)</code></pre>
<p>Figure 2. Model H&amp;C. Distributions of fragment lengths l in
heparinases I (a) and III (b) digests (crosses) as compared to
distributions expected under model H&amp;C (dots). Modeling results are
summarized for 100 runs of optimization with different initial
conditions. Transition probabilities of homogeneous Markov models for
H&amp;C (c) and H&amp;I (d).</p>
<pre class="r"><code># Plot
read_and_aggregate_hc_fit &lt;- function(folder_path, pattern) {
  files &lt;- list.files(path = folder_path, pattern = pattern, full.names = TRUE)
  
  if (length(files) == 0) {
     warning(paste(&quot;No files found for pattern:&quot;, pattern))
     return(data.frame(l=1:10, hmod_mean=runif(10,0.01,0.2), hmod_min=0, hmod_max=0.3, fexp=runif(10,0.01,0.2)))
  }
  
  data_list &lt;- lapply(files, read.table, header = TRUE)
  df_all &lt;- do.call(rbind, data_list)
  
  stats_agg &lt;- aggregate(hmod ~ l, data = df_all, function(x) c(mean = mean(x), min = min(x), max = max(x)))
  
  df_res &lt;- data.frame(
    l = stats_agg$l,
    hmod_mean = stats_agg$hmod[, &quot;mean&quot;],
    hmod_min  = stats_agg$hmod[, &quot;min&quot;],
    hmod_max  = stats_agg$hmod[, &quot;max&quot;]
  )
  
  df_exp &lt;- data_list[[1]][, c(&quot;l&quot;, &quot;fexp&quot;)]
  merge(df_res, df_exp, by = &quot;l&quot;)
}

get_hc_matrix &lt;- function(folder_path) {
  files &lt;- list.files(path = folder_path, pattern = &quot;MM\\.s[0-9]+\\.P\\.res&quot;, full.names = TRUE)
  
  if (length(files) &gt; 0) {
    tables &lt;- lapply(files, function(f) {
      d &lt;- read.table(f, header = TRUE, col.names = c(&quot;prev&quot;, &quot;nxt&quot;, &quot;p&quot;))
      d$prev &lt;- toupper(d$prev); d$nxt &lt;- toupper(d$nxt)
      return(d)
    })
    
    df_all &lt;- do.call(rbind, tables)
    df_agg &lt;- aggregate(p ~ prev + nxt, data = df_all, mean)
    
    get_p &lt;- function(prev, nxt) {
      val &lt;- df_agg$p[df_agg$prev == prev &amp; df_agg$nxt == nxt]
      if (length(val) == 0) 0 else val
    }
    
    matrix(c(get_p(&quot;U&quot;,&quot;U&quot;), get_p(&quot;U&quot;,&quot;S&quot;), get_p(&quot;S&quot;,&quot;U&quot;), get_p(&quot;S&quot;,&quot;S&quot;)), nrow=2, byrow=TRUE)
  } else {
    matrix(c(0.53, 0.47, 0.14, 0.86), nrow=2, byrow=TRUE)
  }
}

get_hi_matrix &lt;- function(file_path = &quot;../input/US.ab.txt&quot;) {
  if (file.exists(file_path)) {
    df &lt;- read.table(file_path, header = TRUE)
    p_u &lt;- df$rho[toupper(df$name) == &quot;U&quot;]; p_s &lt;- df$rho[toupper(df$name) == &quot;S&quot;]
    
    if (length(p_u) == 0) p_u &lt;- 0; if (length(p_s) == 0) p_s &lt;- 0
    
    matrix(c(p_u, p_s, p_u, p_s), nrow=2, byrow=TRUE) 
  } else {
    matrix(c(0.8642, 0.1358, 0.8642, 0.1358), nrow=2, byrow=TRUE)
  }
}

plot_hc_fit_panel &lt;- function(df, title, threshold) {
  x_labs &lt;- as.character(df$l)
  if (max(df$l) == threshold) x_labs[length(x_labs)] &lt;- paste0(&quot;≥&quot;, threshold)
  
  ggplot(df, aes(x = factor(l))) +
    geom_errorbar(aes(ymin = hmod_min, ymax = hmod_max), width = 0.6) +
    geom_point(aes(y = fexp, shape = &quot;Experimental&quot;), size = 5, stroke = 1) +
    geom_point(aes(y = hmod_mean, shape = &quot;Model H&amp;C&quot;), size = 5, stroke = 1) +
    scale_y_log10() +
    scale_shape_manual(name = &quot;&quot;, values = c(&quot;Experimental&quot; = 4, &quot;Model H&amp;C&quot; = 1)) +
    scale_x_discrete(labels = x_labs) +
    labs(title = title, x = &quot;Fragment Length l&quot;, y = &quot;Relative Abundance (log scale)&quot;) +
    theme_bw() +
    theme(
      legend.position = &quot;bottom&quot;,
      legend.text = element_text(size = 14),      
      panel.grid.minor = element_blank(),
      axis.text = element_text(size = 14),        
      axis.title = element_text(size = 16),       
      plot.title = element_text(size = 18, face = &quot;bold&quot;)
    )
}

plot_matrix_heatmap &lt;- function(t_mat, title) {
   df_mat &lt;- data.frame(
    Prev = rep(c(&quot;U&quot;, &quot;S&quot;), each = 2),
    Next = rep(c(&quot;U&quot;, &quot;S&quot;), times = 2),
    Prob = as.vector(t(t_mat)) 
  )
  
  df_mat$Prev &lt;- factor(df_mat$Prev, levels = c(&quot;S&quot;, &quot;U&quot;)) 
  df_mat$Next &lt;- factor(df_mat$Next, levels = c(&quot;U&quot;, &quot;S&quot;))

  ggplot(df_mat, aes(x = Next, y = Prev)) +
    geom_tile(aes(fill = Prob), color = &quot;black&quot;, size = 1) +
    geom_text(aes(label = sprintf(&quot;%.2f&quot;, Prob)), size = 8, fontface = &quot;bold&quot;) +
    scale_fill_gradient(low = &quot;white&quot;, high = &quot;#6baed6&quot;, limits = c(0, 1)) +
    scale_x_discrete(position = &quot;top&quot;) + 
    labs(
      title = title,
      x = &quot;Next State&quot;, 
      y = &quot;Previous State&quot;,
      fill = &quot;Probability&quot;
    ) +
    theme_minimal() +
    theme(
      panel.grid = element_blank(),
      legend.position = &quot;none&quot;,
      axis.text = element_text(size = 14, face = &quot;bold&quot;),    
      axis.title = element_text(size = 16, face = &quot;bold&quot;),  
      plot.title = element_text(size = 18, face = &quot;bold&quot;, hjust = 0.5, margin = margin(b=10)) 
    )
}

folder_hc &lt;- &quot;../output/HC/&quot;

df_fit_hepI   &lt;- read_and_aggregate_hc_fit(folder_hc, &quot;HC\\.s[0-9]+\\.hepI\\.fit\\.res&quot;)
df_fit_hepIII &lt;- read_and_aggregate_hc_fit(folder_hc, &quot;HC\\.s[0-9]+\\.hepIII\\.fit\\.res&quot;)
mat_hc &lt;- get_hc_matrix(folder_hc)
mat_hi &lt;- get_hi_matrix(&quot;../input/US.ab.txt&quot;)

p_a &lt;- plot_hc_fit_panel(df_fit_hepI,   &quot;(a) Heparinase I (Model H&amp;C)&quot;, 11)
p_b &lt;- plot_hc_fit_panel(df_fit_hepIII, &quot;(b) Heparinase III (Model H&amp;C)&quot;, 6)
p_c &lt;- plot_matrix_heatmap(mat_hc, &quot;(c) Model H&amp;C Transition Matrix&quot;)
p_d &lt;- plot_matrix_heatmap(mat_hi, &quot;(d) Model H&amp;I Transition Matrix&quot;)

(p_a + p_b) / (p_c + p_d)</code></pre>
<p><img src="figure_examples_files/figure-html/figure2_plot-1.png" width="1152" /></p>
</div>
<div id="figure-3" class="section level2">
<h2>Figure 3</h2>
<pre class="r"><code># Data
input_dir_abs &lt;- paste0(normalizePath(&quot;../input/&quot;, mustWork = TRUE), &quot;/&quot;)
output_dir_abs &lt;- paste0(normalizePath(&quot;../output/NI/&quot;, mustWork = TRUE), &quot;/&quot;)
java_args &lt;- .jarray(c(input_dir_abs, output_dir_abs), &quot;java/lang/String&quot;)
.jcall(&quot;heparansulfate.NIModelSA&quot;, &quot;V&quot;, &quot;main&quot;, java_args)</code></pre>
<p>Figure 3. Model N&amp;I. Distributions of fragment length l in
heparinases I (a) and III (b) digests (crosses) as compared to
distributions expected under model N&amp;I (dots). Optimized profiles of
S (c) and U (d) proportions along chains. Modeling results are
summarized for 100 runs of optimization with different initial
conditions.</p>
<pre class="r"><code># Plot
read_ni_fit &lt;- function(folder_path, pattern) {
  files &lt;- list.files(path = folder_path, pattern = pattern, full.names = TRUE)
  
  if (length(files) == 0) {
    warning(paste(&quot;No files found for pattern:&quot;, pattern))
    return(data.frame(l=1:10, hmod_mean=runif(10,0.01,0.1), hmod_min=0, hmod_max=0.2, fexp=runif(10,0.01,0.1)))
  }
  
  data_list &lt;- lapply(files, read.table, header = TRUE)
  df_all &lt;- do.call(rbind, data_list)
  
  stats &lt;- aggregate(hmod ~ l, data = df_all, function(x) c(mean = mean(x), min = min(x), max = max(x)))
  
  df_res &lt;- data.frame(
    l = stats$l,
    hmod_mean = stats$hmod[, &quot;mean&quot;],
    hmod_min  = stats$hmod[, &quot;min&quot;],
    hmod_max  = stats$hmod[, &quot;max&quot;]
  )
  
  df_exp &lt;- data_list[[1]][, c(&quot;l&quot;, &quot;fexp&quot;)]
  merge(df_res, df_exp, by = &quot;l&quot;)
}

read_ni_profiles &lt;- function(folder_path) {
  files &lt;- list.files(path = folder_path, pattern = &quot;PM\\.s[0-9]+\\.gamma\\.res&quot;, full.names = TRUE)
  
  if (length(files) == 0) {
    warning(&quot;No gamma.res files found.&quot;)
    return(data.frame(position=1:16, s_mean=runif(16), s_min=0, s_max=1, u_mean=runif(16), u_min=0, u_max=1))
  }
  
  data_list &lt;- lapply(files, read.table, header = TRUE)
  df_all &lt;- do.call(rbind, data_list)
  
  stats_s &lt;- aggregate(s ~ position, data = df_all, function(x) c(mean = mean(x), min = min(x), max = max(x)))
  
  stats_u &lt;- aggregate(u ~ position, data = df_all, function(x) c(mean = mean(x), min = min(x), max = max(x)))
  
  data.frame(
    position = stats_s$position,
    s_mean = stats_s$s[, &quot;mean&quot;], s_min = stats_s$s[, &quot;min&quot;], s_max = stats_s$s[, &quot;max&quot;],
    u_mean = stats_u$u[, &quot;mean&quot;], u_min = stats_u$u[, &quot;min&quot;], u_max = stats_u$u[, &quot;max&quot;]
  )
}

plot_fit_panel &lt;- function(df, title, threshold) {
  x_labs &lt;- as.character(df$l)
  if (max(df$l) == threshold) x_labs[length(x_labs)] &lt;- paste0(&quot;≥&quot;, threshold)
  
  ggplot(df, aes(x = factor(l))) +
    geom_errorbar(aes(ymin = hmod_min, ymax = hmod_max), width = 0.6) +
    
    geom_point(aes(y = fexp, shape = &quot;Experimental&quot;), size = 5, stroke = 1) +
    geom_point(aes(y = hmod_mean, shape = &quot;Model N&amp;I&quot;), size = 5) +
    scale_y_log10() +
    scale_shape_manual(name = &quot;&quot;, values = c(&quot;Experimental&quot; = 4, &quot;Model N&amp;I&quot; = 1)) + 
    scale_x_discrete(labels = x_labs) +
    labs(title = title, x = &quot;Fragment Length l&quot;, y = &quot;Relative Abundance (log scale)&quot;) +
    theme_bw() +
    theme(legend.position = &quot;bottom&quot;, 
          legend.text = element_text(size = 14),
          panel.grid.minor = element_blank(),
          axis.text = element_text(size = 12),        
          axis.title = element_text(size = 14),       
          plot.title = element_text(size = 16, face = &quot;bold&quot;))
          }

plot_profile_panel &lt;- function(df, variable, title) {
  y_mean &lt;- df[[paste0(variable, &quot;_mean&quot;)]]
  y_min  &lt;- df[[paste0(variable, &quot;_min&quot;)]]
  y_max  &lt;- df[[paste0(variable, &quot;_max&quot;)]]
  
  ggplot(df, aes(x = position)) +
    geom_errorbar(aes(ymin = y_min, ymax = y_max), width = 0.6, color = &quot;black&quot;) +
    
    geom_line(aes(y = y_mean), color = &quot;black&quot;, alpha = 0.6) +
    
    geom_point(aes(y = y_mean), shape = 1, size = 4) +
    
    scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
    scale_x_continuous(breaks = df$position) + 
    labs(title = title, x = &quot;Position along chain&quot;, y = &quot;Probability&quot;) +
    theme_bw() +
    theme(panel.grid.minor = element_blank(),
          legend.text = element_text(size = 14),
          axis.text = element_text(size = 14),        
          axis.title = element_text(size = 16),       
          plot.title = element_text(size = 18, face = &quot;bold&quot;)) 
}

folder_ni &lt;- &quot;../output/NI/&quot;

df_fit_hepI   &lt;- read_ni_fit(folder_ni, &quot;PM\\.s[0-9]+\\.hepI\\.fit\\.res&quot;)
df_fit_hepIII &lt;- read_ni_fit(folder_ni, &quot;PM\\.s[0-9]+\\.hepIII\\.fit\\.res&quot;)
df_profiles   &lt;- read_ni_profiles(folder_ni)

p_a &lt;- plot_fit_panel(df_fit_hepI,   &quot;(a) Heparinase I (Model N&amp;I)&quot;, 11)
p_b &lt;- plot_fit_panel(df_fit_hepIII, &quot;(b) Heparinase III (Model N&amp;I)&quot;, 6)
p_c &lt;- plot_profile_panel(df_profiles, &quot;s&quot;, &quot;(c) Profile of S proportions&quot;)
p_d &lt;- plot_profile_panel(df_profiles, &quot;u&quot;, &quot;(d) Profile of U proportions&quot;)

(p_a + p_b) / (p_c + p_d)</code></pre>
<p><img src="figure_examples_files/figure-html/figure_3_plot-1.png" width="1152" /></p>
</div>
<div id="figure-4" class="section level2">
<h2>Figure 4</h2>
<pre class="r"><code># Data
input_dir_abs &lt;- paste0(normalizePath(&quot;../input/&quot;, mustWork = TRUE), &quot;/&quot;)
output_dir_abs &lt;- paste0(normalizePath(&quot;../output/LP/&quot;, mustWork = TRUE), &quot;/&quot;)
java_args &lt;- .jarray(c(input_dir_abs, output_dir_abs), &quot;java/lang/String&quot;)
.jcall(&quot;heparansulfate.ProfileFeasibility&quot;, &quot;V&quot;, &quot;main&quot;, java_args)
.jcall(&quot;heparansulfate.HomogeneityFeasibility&quot;, &quot;V&quot;, &quot;main&quot;, java_args)
</code></pre>
<p>Figure 4. Infeasibility of constraint sets as a function of BKHS
chain length n. Dots: constraints of heparinase digests and overall
disaccharide composition. Crosses: constraints of heparinase digests and
homogeneity.</p>
<pre class="r"><code># Plot
file_feas &lt;- &quot;../output/LP/Feasibility.res&quot;
file_hom  &lt;- &quot;../output/LP/HomogeneityFeasibility.res&quot;

df_comp &lt;- read.table(file_feas, header = TRUE, sep = &quot;\t&quot;)
df_comp$Dataset &lt;- &quot;Overall composition&quot;

df_hom &lt;- read.table(file_hom, header = TRUE, sep = &quot;\t&quot;)
df_hom$Dataset &lt;- &quot;Homogeneity&quot;

df_all &lt;- rbind(df_comp, df_hom)

ggplot(df_all, aes(x = n, y = infeasibility)) +
  geom_line(aes(group = Dataset), color = &quot;gray&quot;, size = 0.5) +  
  geom_point(aes(shape = Dataset), size = 4, stroke = 1) +
  scale_y_log10(breaks = 10^seq(0, -16, by = -4), 
                labels = scales::trans_format(&quot;log10&quot;, scales::math_format(10^.x))) +
  scale_shape_manual(name = &quot;&quot;, 
                     values = c(&quot;Overall composition&quot; = 1, &quot;Homogeneity&quot; = 4)) +
  
  labs(x = &quot;BKHS chain length n&quot;, y = &quot;Infeasibility&quot;) +
  theme_bw() +
  theme(
    legend.position = &quot;bottom&quot;, 
    legend.text = element_text(size = 14),
    panel.grid.minor = element_blank(),
    axis.text = element_text(size = 14),        
    axis.title = element_text(size = 16),       
    plot.title = element_text(size = 18, face = &quot;bold&quot;)
  )</code></pre>
<p><img src="figure_examples_files/figure-html/figure_4_plot-1.png" width="672" /></p>
</div>
<div id="figure-5" class="section level2">
<h2>Figure 5</h2>
<pre class="r"><code># Data
input_dir_abs &lt;- paste0(normalizePath(&quot;../input/&quot;, mustWork = TRUE), &quot;/&quot;)
output_dir_abs &lt;- paste0(normalizePath(&quot;../output/ME/&quot;, mustWork = TRUE), &quot;/&quot;)
java_args &lt;- .jarray(c(input_dir_abs, output_dir_abs), &quot;java/lang/String&quot;)
.jcall(&quot;heparansulfate.MaxEntModel&quot;, &quot;V&quot;, &quot;main&quot;, java_args)
.jcall(&quot;heparansulfate.GradientWidth&quot;, &quot;V&quot;, &quot;main&quot;, java_args)</code></pre>
<p>Figure 5. (a,b) Maximum-entropy estimates of S and U composition
along BKHS chains (circles) and lower and upper bounds at each position
estimated via linear programming (squares). Horizontal lines display
overall S and U proportions. (c,d) Profiles of transition probabilities
between disaccharides along chains, as estimated with maximum-entropy
modeling (black symbols) and compared to the profile of disaccharide
composition along chains (white symbols).</p>
<pre class="r"><code># Plot
gamma_file &lt;- &quot;../output/ME/MEM.gamma.res&quot;
pt_file    &lt;- &quot;../output/ME/MEM.pt.res&quot;
ab_file    &lt;- &quot;../input/US.ab.txt&quot;
gw_file    &lt;- &quot;../output/ME/GradientWidth.res&quot;

df_gamma &lt;- read.table(gamma_file, header = TRUE, sep = &quot;\t&quot;)

df_pt &lt;- read.table(pt_file, header = TRUE, sep = &quot;\t&quot;)

df_ab &lt;- read.table(ab_file, header = TRUE, sep = &quot;\t&quot;)
rho_S &lt;- df_ab$rho[df_ab$name == &quot;s&quot; | df_ab$name == &quot;S&quot;]
rho_U &lt;- df_ab$rho[df_ab$name == &quot;u&quot; | df_ab$name == &quot;U&quot;]

df_gw &lt;- read.table(gw_file, header = TRUE, sep = &quot;\t&quot;)


p_a &lt;- ggplot() +
  geom_hline(yintercept = rho_S, linetype = &quot;solid&quot;, color = &quot;black&quot;) +
  geom_segment(data = df_gw, aes(x = pos, xend = pos, y = lowerS, yend = upperS),
               linetype = &quot;dotted&quot;, size = 0.5, color = &quot;black&quot;) +
  geom_point(data = df_gw, aes(x = pos, y = lowerS), shape = 15, size = 3, color = &quot;black&quot;) +
  geom_point(data = df_gw, aes(x = pos, y = upperS), shape = 15, size = 3, color = &quot;black&quot;) +
  geom_point(data = df_gamma, aes(x = pos, y = s), shape = 1, size = 4, stroke = 1.2, color = &quot;black&quot;) +
  scale_y_continuous(limits = c(0, 1)) +
  scale_x_continuous(breaks = seq(1, max(df_gamma$pos), 1)) +
  labs(title = &quot;(a) S&quot;, x = &quot;Position from non-reducing end&quot;, y = &quot;Proportion&quot;) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, face = &quot;bold&quot;, size = 16),
        axis.text = element_text(size = 12), axis.title = element_text(size = 14),
        panel.grid.minor = element_blank())

p_b &lt;- ggplot() +
  geom_hline(yintercept = rho_U, linetype = &quot;solid&quot;, color = &quot;black&quot;) +
  geom_segment(data = df_gw, aes(x = pos, xend = pos, y = lowerU, yend = upperU),
               linetype = &quot;dotted&quot;, size = 0.5, color = &quot;black&quot;) +
  geom_point(data = df_gw, aes(x = pos, y = lowerU), shape = 15, size = 3, color = &quot;black&quot;) +
  geom_point(data = df_gw, aes(x = pos, y = upperU), shape = 15, size = 3, color = &quot;black&quot;) +
  geom_point(data = df_gamma, aes(x = pos, y = u), shape = 1, size = 4, stroke = 1.2, color = &quot;black&quot;) +
  scale_y_continuous(limits = c(0, 1)) +
  scale_x_continuous(breaks = seq(1, max(df_gamma$pos), 1)) +
  labs(title = &quot;(b) U&quot;, x = &quot;Position from non-reducing end&quot;, y = &quot;Proportion&quot;) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, face = &quot;bold&quot;, size = 16),
        axis.text = element_text(size = 12), axis.title = element_text(size = 14),
        panel.grid.minor = element_blank())

p_c &lt;- ggplot() +
  geom_line(data = df_gamma, aes(x = pos, y = s), color = &quot;gray&quot;, size = 0.5) +
  geom_point(data = df_gamma, aes(x = pos, y = s), shape = 0, size = 4, color = &quot;gray&quot;, stroke = 1) +
  geom_line(data = df_gamma, aes(x = pos, y = u), color = &quot;gray&quot;, size = 0.5) +
  geom_point(data = df_gamma, aes(x = pos, y = u), shape = 1, size = 4, color = &quot;gray&quot;, stroke = 1) +

  geom_line(data = df_pt, aes(x = pos, y = pus), color = &quot;black&quot;, size = 0.5) +
  geom_point(data = df_pt, aes(x = pos, y = pus), shape = 15, size = 4, color = &quot;black&quot;) +
  geom_line(data = df_pt, aes(x = pos, y = puu), color = &quot;black&quot;, size = 0.5) +
  geom_point(data = df_pt, aes(x = pos, y = puu), shape = 16, size = 4, color = &quot;black&quot;) +
  
  annotate(&quot;point&quot;, x = 10, y = 0.75, shape = 16, size = 4, color = &quot;black&quot;) +
  annotate(&quot;text&quot;,  x = 10.5, y = 0.75, label = &quot;from U to U&quot;, hjust = 0, size = 4) +
  annotate(&quot;point&quot;, x = 10, y = 0.20, shape = 15, size = 4, color = &quot;black&quot;) +
  annotate(&quot;text&quot;,  x = 10.5, y = 0.20, label = &quot;from U to S&quot;, hjust = 0, size = 4) +
  scale_y_continuous(limits = c(0, 1)) +
  scale_x_continuous(breaks = seq(1, max(df_pt$pos), 1)) +
  labs(title = &quot;(c) Transitions from U&quot;, x = &quot;Position from non-reducing end&quot;, y = &quot;Probability&quot;) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, face = &quot;bold&quot;, size = 16),
        axis.text = element_text(size = 12), axis.title = element_text(size = 14),
        panel.grid.minor = element_blank())


p_d &lt;- ggplot() +
  geom_line(data = df_gamma, aes(x = pos, y = s), color = &quot;gray&quot;, size = 0.5) +
  geom_point(data = df_gamma, aes(x = pos, y = s), shape = 0, size = 4, color = &quot;gray&quot;, stroke = 1) +
  geom_line(data = df_gamma, aes(x = pos, y = u), color = &quot;gray&quot;, size = 0.5) +
  geom_point(data = df_gamma, aes(x = pos, y = u), shape = 1, size = 4, color = &quot;gray&quot;, stroke = 1) +

  geom_line(data = df_pt, aes(x = pos, y = pss), color = &quot;black&quot;, size = 0.5) +
  geom_point(data = df_pt, aes(x = pos, y = pss), shape = 15, size = 4, color = &quot;black&quot;) +
  geom_line(data = df_pt, aes(x = pos, y = psu), color = &quot;black&quot;, size = 0.5) +
  geom_point(data = df_pt, aes(x = pos, y = psu), shape = 16, size = 4, color = &quot;black&quot;) +
  
  annotate(&quot;point&quot;, x = 10, y = 0.85, shape = 16, size = 4, color = &quot;black&quot;) +
  annotate(&quot;text&quot;,  x = 10.5, y = 0.85, label = &quot;from S to U&quot;, hjust = 0, size = 4) +
  annotate(&quot;point&quot;, x = 10, y = 0.20, shape = 15, size = 4, color = &quot;black&quot;) +
  annotate(&quot;text&quot;,  x = 10.5, y = 0.20, label = &quot;from S to S&quot;, hjust = 0, size = 4) +
  scale_y_continuous(limits = c(0, 1)) +
  scale_x_continuous(breaks = seq(1, max(df_pt$pos), 1)) +
  labs(title = &quot;(d) Transitions from S&quot;, x = &quot;Position from non-reducing end&quot;, y = &quot;Probability&quot;) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, face = &quot;bold&quot;, size = 16),
        axis.text = element_text(size = 12), axis.title = element_text(size = 14),
        panel.grid.minor = element_blank())

(p_a | p_b) / (p_c | p_d)</code></pre>
<p><img src="figure_examples_files/figure-html/figure_5_plot-1.png" width="1152" /></p>
</div>
<div id="figure-6" class="section level2">
<h2>Figure 6</h2>
<pre class="r"><code>
# Data, individual species abundances
input_dir_abs &lt;- paste0(normalizePath(&quot;../input/&quot;, mustWork = TRUE), &quot;/&quot;)
output_dir_abs &lt;- paste0(normalizePath(&quot;../output/MEW/&quot;, mustWork = TRUE), &quot;/&quot;)
.jcall(&quot;heparansulfate.MaxEntModelW&quot;, &quot;V&quot;, &quot;makeSig35Filtered&quot;, input_dir_abs, output_dir_abs)
.jcall(&quot;heparansulfate.MaxEntModelW&quot;, &quot;V&quot;, &quot;makeSig15Filtered&quot;, input_dir_abs, output_dir_abs)</code></pre>
<pre class="r"><code># Data, averages over individual species
input_dir_abs &lt;- paste0(normalizePath(&quot;../input/&quot;, mustWork = TRUE), &quot;/&quot;)
output_dir_abs &lt;- paste0(normalizePath(&quot;../output/MEW/&quot;, mustWork = TRUE), &quot;/&quot;)
.jcall(&quot;heparansulfate.MaxEntModelW&quot;, &quot;V&quot;, &quot;glAndRholAndProfExamplesFiltered&quot;, input_dir_abs, output_dir_abs)

# Data, LP bounds
.jcall(&quot;heparansulfate.GradientWidth&quot;, &quot;V&quot;, &quot;defaultMixSpec&quot;, input_dir_abs, output_dir_abs)
# Data, chain length distributions
output_path &lt;- paste0(normalizePath(&quot;../output/MEW/&quot;, mustWork = TRUE), &quot;/FullDistSig3.5.res&quot;)
.jcall(&quot;heparansulfate.MixSpecies&quot;, &quot;V&quot;, &quot;saveDistribution&quot;, as.integer(10), as.integer(20), 3.5, 16., output_path)
output_path &lt;- paste0(normalizePath(&quot;../output/MEW/&quot;, mustWork = TRUE), &quot;/FullDistSig1.5.res&quot;)
.jcall(&quot;heparansulfate.MixSpecies&quot;, &quot;V&quot;, &quot;saveDistribution&quot;, as.integer(10), as.integer(20), 1.5, 16., output_path)</code></pre>
<p>Figure 6. (a,b) Two models of BKHS chain length distributions (a) and
resulting chain disaccharide composition as a function of their length
under maximum-entropy modeling (b). (c-f) Estimations of nonhomogeneity
and correlation profiles when BKHS is modeled as a mixture of chain
lengths (<span class="math inline">\(10 ≤ n ≤ 20, \sigma
= 3.5)\)</span>. Chains are either aligned by their non-reducing end
(c,e) or their reducing end (d,f). (c,d) maximum-entropy composition
profile (circles), bounds at each position (squares) and overall
composition (horizontal line). (e,f) transition probabilities from S to
S or U (black) compared to probabilities under independence (white).</p>
<p><img src="figure_examples_files/figure-html/figure_6_plot-1.png" width="1152" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
